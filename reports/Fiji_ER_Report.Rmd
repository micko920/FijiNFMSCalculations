---
title: "Fiji ER Report"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes: \usepackage{caption}
params:
  file_format: html
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE,
                      message=FALSE, warning=FALSE)

library(rlang)
library(dplyr)
library(kableExtra)
library(FijiNFMSCalculations)
if (!exists("fileFormat")) fileFormat <- params$file_format
getOption("max.print")
```

\captionsetup[table]{labelformat=empty}



# Monitoring Period yearly chart of accounts FRL and Monitored Em/Rems
```{r echo = FALSE}
options(max.print=1000000)

mp_yearly <- 
  cbind(
    t(rbind(as.data.frame(EmRems_Values$year1),as.data.frame(EmRems_Values$year2))),
    as.data.frame(replicate(3, rep.int(0,22))))
  
mp_yearly <- mp_yearly[order(row.names(mp_yearly)),]
      
names(mp_yearly) <- c(2019:2023)



overall_frl <- rbind( 
  ErpaYearlyFRL$erpa_yearly$yearly[2:6],
  mp_yearly[1:5]
)


row.names(overall_frl) <- NULL

overall_frl <- cbind(
  data.frame(value = c(t(ErpaYearlyFRL$erpa_yearly$yearly[1]), row.names(mp_yearly))),
  overall_frl
)

row.names(overall_frl) <- NULL
t <- overall_frl
t %>% 
  kable(fileFormat, caption = "Monitoring Period FRL and Monitored values",  
        format.args = list(big.mark = ",", digits= 4, nsmall = 4)) %>%
  
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )


```
# Year Monitoring Period Results Tables
## Year 1
```{r echo = FALSE}
t <- ResultsTables$year1
t %>% 
  kable(fileFormat, caption = "Monitoring Period values: year 1",
        format.args = list(big.mark = ",", digits= 4, nsmall = 4)) %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )

```

## Year 2
```{r echo = FALSE}
t <- ResultsTables$year2
t %>% 
  kable(fileFormat, caption = "Monitoring Period values: year 2",
        format.args = list(big.mark = ",", digits= 4, nsmall = 4)) %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )

```

# Table of Parameters and uncertainty
```{r echo = FALSE}
    ParameterTable <- data.frame(
      name = character(), 
      value = numeric(), 
      LCI = numeric(), 
      UCI=numeric(), 
      error = numeric(),
      model=character(),
      stringsAsFactors=FALSE)

    ParameterTable <- rbind(ParameterTable, list(
      name = "EFDeforUp", 
      value = EFDeforUp, 
      LCI = EFDeforUp_LCI, 
      UCI= EFDeforUp_UCI, 
      error = NA,
      model="Triangle"),
      stringsAsFactors=FALSE)
    
    
    ParameterTable <- rbind(ParameterTable,list(
      name  = "EFDeforLow",
      value = EFDeforLow,
      LCI   = EFDeforLow_LCI,
      UCI   = EFDeforLow_UCI,
      error    = NA,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
  
     ParameterTable <- rbind(ParameterTable,list(
      name  = "TEF",
      value = TEF,
      LCI   = TEF - TEF * errTEF,
      UCI   = TEF + TEF * errTEF,
      error    = errTEF,
      model ="Triangle"
    ), stringsAsFactors=FALSE)


  ParameterTable <- rbind(ParameterTable,list(
      name  = "MAIBsw",
      value = MAIBsw,
      LCI   = MAIBsw - MAIBsw * errMAIBsw,
      UCI   = MAIBsw + MAIBsw * errMAIBsw,
      error    = errMAIBsw,
      model ="Triangle"
    ), stringsAsFactors=FALSE)


  ParameterTable <- rbind(ParameterTable,list(
      name  = "EFNFDeg",
      value = EFNFDeg,
      LCI   = EFNFDeg_LCI,
      UCI   = EFNFDeg_UCI,
      error    = NA,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
  
   ParameterTable <- rbind(ParameterTable,list(
      name  = "MAICFell",
      value = MAICFell,
      LCI   = MAICFell - MAICFell * ErrMAICFell,
      UCI   = MAICFell + MAICFell * ErrMAICFell,
      error    = ErrMAICFell,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
  
   
    ParameterTable <- rbind(ParameterTable,list(
      name  = "MAIVar",
      value = MAIVar,
      LCI   = MAIVar - (MAIVar * errMAIVar),
      UCI   = MAIVar + (MAIVar * errMAIVar),
      error    = errMAIVar,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
    
    
    ParameterTable <- rbind(ParameterTable,list(
      name  = "MAIVhw",
      value = MAIVhw,
      LCI   = MAIVhw - MAIVhw * errMAIVhw,
      UCI   = MAIVhw + MAIVhw * errMAIVhw,
      error = errMAIVhw,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
    
    ParameterTable <- rbind(ParameterTable,list(
      name  = "BiomassConvExpansionARefor",
      value = BiomassConvExpansionARefor,
      LCI   = BiomassConvExpansionARefor - (BiomassConvExpansionARefor * errBiomassConvExpansionARefor),
      UCI   = BiomassConvExpansionARefor + (BiomassConvExpansionARefor * errBiomassConvExpansionARefor),
      error = errBiomassConvExpansionARefor,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
    
    ParameterTable <- rbind(ParameterTable,list(
      name  = "BiomassConvExpansionHW",
      value = BiomassConvExpansionHW,
      LCI   = BiomassConvExpansionHW - BiomassConvExpansionHW * errBiomassConvExpansionHW,
      UCI   = BiomassConvExpansionHW + BiomassConvExpansionHW * errBiomassConvExpansionHW,
      error = errBiomassConvExpansionHW,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
    
    ParameterTable <- rbind(ParameterTable,list(
      name  = "BiomassConvExpansionIncHW",
      value = BiomassConvExpansionHW,
      LCI   = BiomassConvExpansionIncHW - BiomassConvExpansionIncHW * errBiomassConvExpansionIncHW,
      UCI   = BiomassConvExpansionIncHW + BiomassConvExpansionIncHW * errBiomassConvExpansionIncHW,
      error = errBiomassConvExpansionIncHW,
      model ="Triangle"
    ), stringsAsFactors=FALSE)
    
    ParameterTable <- rbind(ParameterTable,list(
      name  = "RootToShootTropRain",
      value = RootToShootTropRain,
      LCI   = RootToShootTropRain - (RootToShootTropRain * errRootToShootTropRain),
      UCI   = RootToShootTropRain + (RootToShootTropRain * errRootToShootTropRain),
      error = errRootToShootTropRain,
      model ="Triangle"
    ), stringsAsFactors=FALSE)    
    
    ParameterTable <- rbind(ParameterTable,list(
      name  = "RootToShootDryLandSmall",
      value = RootToShootDryLandSmall,
      LCI   = errLowerRtSDryLandSmall,
      UCI   = errUpperRtSDryLandSmall,
      error = NA,
      model ="Triangle"
    ), stringsAsFactors=FALSE)    

    ParameterTable <- rbind(ParameterTable,list(
      name  = "RootToShootDryLandBig",
      value = RootToShootDryLandBig,
      LCI   = errLowerRtSDryLandBig,
      UCI   = errUpperRtSDryLandBig,
      error = NA,
      model ="Triangle"
    ), stringsAsFactors=FALSE)    
   
   ParameterTable <- rbind(ParameterTable,list(
      name  = "RecoveryRateSW",
      value = RecoveryRateSW,
      LCI = qnorm(p = c(QLCI), mean = RecoveryRateSW, sd = (RecoveryRateSW * errRecoveryRateSW)),
      UCI = qnorm(p = c(QUCI), mean = RecoveryRateSW, sd = (RecoveryRateSW * errRecoveryRateSW)),
      error = errRecoveryRateSW,
      model ="Norm"
    ), stringsAsFactors=FALSE)    
   
    ParameterTable <- rbind(ParameterTable,list(
      name  = "WoodDensitySW",
      value = WoodDensitySW,
      LCI = qnorm(p = c(QLCI), mean = WoodDensitySW, sd = SDWoodDensitySW),
      UCI = qnorm(p = c(QUCI), mean = WoodDensitySW, sd = SDWoodDensitySW),
      error = NA,
      model ="Norm"
    ), stringsAsFactors=FALSE)  
    
ParameterTable %>% 
  kable(fileFormat, caption = "Parameter and associated uncertainty",
        format.args = list(big.mark = ",", digits= 4, nsmall = 4)) %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )
     
```
    
# Table of Monitoring Report Parameters 
```{r echo = FALSE}
MonitoringReportParams %>% 
  kable(fileFormat, caption = "Monitoring report parameters",
        format.args = list(big.mark = ",", digits= 4, nsmall = 4)) %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )
     
```
